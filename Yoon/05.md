서버의 부하 분산을 위해 해시 사용

# 해시 키 재배치 문제

- 서버 추가/삭제 시, 키 값을 재분배해야 할 것이다.
- 예로, 1번 서버가 장애가 나서 동작을 중단하면 서버 풀의 크기가 감소하면 키에 대한 **해시 값**은 변하지 않지만 나머지 연산을 적용해 계산한 **서버 인덱스 값**은 달라진다.
    - 1번 서버가 죽으면 해시 값을 다른 서버로 보낼 수 있지만 서버 인덱스 값이 달라질 것이므로 캐싱되지 않은 서버로 접속하게되서, **캐시 미스**가 발생한다.
- 위의 그림에서 hash(key) % 15 한 값은, hash(key) % 14 한 값과 다를 것이다.

# 안정 해시
- 해시 키 재배치 문제를 해결하고자 등장.
- 해시 테이블 크기가 조정될 때 평균적으로 오직 k/n개의 키만 재배치하는 해시 기술 → 서버 변한다고해서 모든 서버가 영향을 받지 않도록!

안정 해시 알고리즘의 기본 절차

- 서버와 키를 균등 분포
- 키에서 시계 방향으로 탐색된 최초의 서버가 키가 저장될 서버

위 안정 해시의 문제점

- hash space가 고르지 않음.
- 균일하지 않은 요청 배포

## 가상 노드

- 위 문제를 해결하기 위해 등장
- 실제 노드 또는 서버를 가리키는 노드로, 하나의 서버는 링 위에 여러 개의 가상 노드를 가질 수 있음.
- 가상 노드를 늘리면 키의 분포가 점점 균등해져 표준 편차를 줄일 수 있음.
- 가상 노드를 너무 늘리면 가상노드 데이터를 저장할 공간이 많이 필요할 것이므로 적당히 조정해야 한다.

# 정리

- 서버 추가/삭제될 때 재배치되는 키의 수가 최소화됨.
- 데이터가 보다 균등하게 분포됨. - 수평적 규모 확장성 달성하기 쉬움.
- 핫스팟 키 문제를 줄임. 특정 샤드에 대한 접근으로 인한 서버 과부하 문제 가능성을 줄인다.